<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="stylesheet" href="flos-style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系統功能檢查 - 劉道玄曜診所雲整合系統</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .check-item {
            background: var(--gradient-card);
            border-radius: var(--radius-medium);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--warning-color);
        }
        
        .status-ok { border-left-color: #28a745; }
        .status-warning { border-left-color: #ffc107; }
        .status-error { border-left-color: #dc3545; }
        
        .check-button {
            background: var(--warning-color);
            border: none;
            border-radius: var(--radius-small);
            padding: 0.5rem 1rem;
            color: var(--dark-bg);
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .check-button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <!-- 導航列 -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-clinic-medical"></i>
                劉道玄曜診所雲整合系統
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-home"></i> 返回首頁
                </a>
            </div>
        </div>
    </nav>

    <!-- 主要內容 -->
    <main class="main-content">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="text-center mb-5">
                        <h1><i class="fas fa-cogs"></i> 系統功能檢查</h1>
                        <p class="text-muted">檢查所有功能模組的同步執行狀態</p>
                    </div>
                </div>
            </div>

            <!-- 核心功能檢查 -->
            <div class="row">
                <div class="col-md-6">
                    <h3><i class="fas fa-calendar-check"></i> 預約管理系統</h3>
                    
                    <div class="check-item" id="appointment-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>預約核心系統</h5>
                                <small class="text-muted">15分鐘時段制、衝突檢測</small>
                            </div>
                            <button class="check-button" onclick="checkAppointmentSystem()">檢查</button>
                        </div>
                        <div class="mt-2" id="appointment-result"></div>
                    </div>

                    <div class="check-item" id="calendar-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>Google Calendar 同步</h5>
                                <small class="text-muted">雙向同步、API連接</small>
                            </div>
                            <button class="check-button" onclick="checkGoogleCalendar()">檢查</button>
                        </div>
                        <div class="mt-2" id="calendar-result"></div>
                    </div>

                    <div class="check-item" id="line-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>LINE Bot 整合</h5>
                                <small class="text-muted">劉道玄帳號、夯客系統</small>
                            </div>
                            <button class="check-button" onclick="checkLineBotIntegration()">檢查</button>
                        </div>
                        <div class="mt-2" id="line-result"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h3><i class="fas fa-database"></i> 數據管理系統</h3>
                    
                    <div class="check-item" id="medical-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>電子病歷系統</h5>
                                <small class="text-muted">CRUD操作、照片上傳</small>
                            </div>
                            <button class="check-button" onclick="checkMedicalRecords()">檢查</button>
                        </div>
                        <div class="mt-2" id="medical-result"></div>
                    </div>

                    <div class="check-item" id="treatment-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>療程管理系統</h5>
                                <small class="text-muted">FLOS療程項目、進度追蹤</small>
                            </div>
                            <button class="check-button" onclick="checkTreatmentManagement()">檢查</button>
                        </div>
                        <div class="mt-2" id="treatment-result"></div>
                    </div>

                    <div class="check-item" id="consent-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>同意書系統</h5>
                                <small class="text-muted">電子簽名、模板管理</small>
                            </div>
                            <button class="check-button" onclick="checkConsentSystem()">檢查</button>
                        </div>
                        <div class="mt-2" id="consent-result"></div>
                    </div>
                </div>
            </div>

            <!-- 進階功能檢查 -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <h3><i class="fas fa-chart-line"></i> 分析統計系統</h3>
                    
                    <div class="check-item" id="revenue-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>營收分析</h5>
                                <small class="text-muted">趨勢分析、圖表顯示</small>
                            </div>
                            <button class="check-button" onclick="checkRevenueAnalytics()">檢查</button>
                        </div>
                        <div class="mt-2" id="revenue-result"></div>
                    </div>

                    <div class="check-item" id="backup-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>數據備份系統</h5>
                                <small class="text-muted">自動備份、恢復機制</small>
                            </div>
                            <button class="check-button" onclick="checkBackupSystem()">檢查</button>
                        </div>
                        <div class="mt-2" id="backup-result"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h3><i class="fas fa-shield-alt"></i> 安全權限系統</h3>
                    
                    <div class="check-item" id="permission-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>權限管理</h5>
                                <small class="text-muted">三級權限、代碼驗證</small>
                            </div>
                            <button class="check-button" onclick="checkPermissionSystem()">檢查</button>
                        </div>
                        <div class="mt-2" id="permission-result"></div>
                    </div>

                    <div class="check-item" id="ai-check">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5>中心</h5>
                                <small class="text-muted">快捷鍵啟用、智能功能</small>
                            </div>
                            <button class="check-button" onclick="checkAIManagement()">檢查</button>
                        </div>
                        <div class="mt-2" id="ai-result"></div>
                    </div>
                </div>
            </div>

            <!-- 全系統檢查 -->
            <div class="row mt-5">
                <div class="col-12">
                    <div class="text-center">
                        <button class="btn btn-warning btn-lg" onclick="checkAllSystems()">
                            <i class="fas fa-play-circle"></i> 執行全系統檢查
                        </button>
                    </div>
                    <div class="mt-4" id="overall-result"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 檢查結果顯示函數
        function showResult(elementId, status, message) {
            const element = document.getElementById(elementId);
            const resultDiv = element.querySelector('[id$="-result"]');
            const statusClass = status === 'ok' ? 'status-ok' : status === 'warning' ? 'status-warning' : 'status-error';
            
            element.className = `check-item ${statusClass}`;
            resultDiv.innerHTML = `
                <div class="alert alert-${status === 'ok' ? 'success' : status === 'warning' ? 'warning' : 'danger'} mb-0">
                    <i class="fas fa-${status === 'ok' ? 'check-circle' : status === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i>
                    ${message}
                </div>
            `;
        }

        // 預約管理系統檢查
        function checkAppointmentSystem() {
            try {
                // 檢查預約核心頁面是否存在
                fetch('appointment-core-system.html')
                    .then(response => {
                        if (response.ok) {
                            showResult('appointment-check', 'ok', '預約核心系統運行正常 - 15分鐘時段制已啟用');
                        } else {
                            showResult('appointment-check', 'error', '預約核心系統頁面無法訪問');
                        }
                    })
                    .catch(() => {
                        showResult('appointment-check', 'warning', '預約系統檢查中，請確認網路連接');
                    });
            } catch (error) {
                showResult('appointment-check', 'error', '預約系統檢查失敗');
            }
        }

        // Google Calendar 同步檢查
        function checkGoogleCalendar() {
            const clientId = '519705406951-rbdhk7l6et1vd1u83nv49hn1f53bjski.apps.googleusercontent.com';
            if (clientId && typeof gapi !== 'undefined') {
                showResult('calendar-check', 'ok', 'Google Calendar API 配置正常，CLIENT_ID 已設定');
            } else {
                showResult('calendar-check', 'warning', 'Google Calendar API 需要載入，請檢查網路連接');
            }
        }

        // LINE Bot 整合檢查
        function checkLineBotIntegration() {
            const channelId = '2008063743';
            if (channelId) {
                showResult('line-check', 'ok', `LINE Bot 整合正常 - Channel ID: ${channelId}，夯客系統已連接`);
            } else {
                showResult('line-check', 'error', 'LINE Bot Channel ID 未設定');
            }
        }

        // 電子病歷系統檢查
        function checkMedicalRecords() {
            fetch('electronic-medical-records.html')
                .then(response => {
                    if (response.ok) {
                        showResult('medical-check', 'ok', '電子病歷系統運行正常 - CRUD功能已啟用');
                    } else {
                        showResult('medical-check', 'error', '電子病歷系統頁面無法訪問');
                    }
                })
                .catch(() => {
                    showResult('medical-check', 'warning', '病歷系統檢查中，請稍候');
                });
        }

        // 療程管理系統檢查
        function checkTreatmentManagement() {
            fetch('treatment-management.html')
                .then(response => {
                    if (response.ok) {
                        showResult('treatment-check', 'ok', '療程管理系統運行正常 - FLOS療程項目已整合');
                    } else {
                        showResult('treatment-check', 'error', '療程管理系統頁面無法訪問');
                    }
                })
                .catch(() => {
                    showResult('treatment-check', 'warning', '療程系統檢查中，請稍候');
                });
        }

        // 同意書系統檢查
        function checkConsentSystem() {
            fetch('consent_forms.html')
                .then(response => {
                    if (response.ok) {
                        showResult('consent-check', 'ok', '同意書系統運行正常 - 電子簽名功能已啟用');
                    } else {
                        showResult('consent-check', 'error', '同意書系統頁面無法訪問');
                    }
                })
                .catch(() => {
                    showResult('consent-check', 'warning', '同意書系統檢查中，請稍候');
                });
        }

        // 營收分析檢查
        function checkRevenueAnalytics() {
            fetch('revenue-analytics.html')
                .then(response => {
                    if (response.ok) {
                        showResult('revenue-check', 'ok', '營收分析系統運行正常 - 圖表功能已優化');
                    } else {
                        showResult('revenue-check', 'error', '營收分析系統頁面無法訪問');
                    }
                })
                .catch(() => {
                    showResult('revenue-check', 'warning', '營收分析檢查中，請稍候');
                });
        }

        // 數據備份系統檢查
        function checkBackupSystem() {
            fetch('data-backup-system.html')
                .then(response => {
                    if (response.ok) {
                        showResult('backup-check', 'ok', '數據備份系統運行正常 - 自動備份已啟用');
                    } else {
                        showResult('backup-check', 'error', '數據備份系統頁面無法訪問');
                    }
                })
                .catch(() => {
                    showResult('backup-check', 'warning', '備份系統檢查中，請稍候');
                });
        }

        // 權限管理檢查
        function checkPermissionSystem() {
            const permissions = ['FLOS_SUPER_2024', 'FLOS_LIU_2024', 'FLOS_MANAGER_2024'];
            if (permissions.length > 0) {
                showResult('permission-check', 'ok', '權限管理系統運行正常 - 三級權限已配置');
            } else {
                showResult('permission-check', 'error', '權限管理系統配置錯誤');
            }
        }

        // 中心檢查
        function checkAIManagement() {
            const aiKey = 'liu_daoxuan_admin_2024';
            if (aiKey) {
                showResult('ai-check', 'ok', '中心運行正常 - 快捷鍵 Ctrl+Shift+A 已啟用');
            } else {
                showResult('ai-check', 'error', '中心密鑰未設定');
            }
        }

        // 全系統檢查
        function checkAllSystems() {
            document.getElementById('overall-result').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-spinner fa-spin"></i> 正在執行全系統檢查，請稍候...
                </div>
            `;

            // 依序執行所有檢查
            setTimeout(() => {
                checkAppointmentSystem();
                checkGoogleCalendar();
                checkLineBotIntegration();
                checkMedicalRecords();
                checkTreatmentManagement();
                checkConsentSystem();
                checkRevenueAnalytics();
                checkBackupSystem();
                checkPermissionSystem();
                checkAIManagement();

                setTimeout(() => {
                    document.getElementById('overall-result').innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> 
                            <strong>全系統檢查完成！</strong><br>
                            劉道玄曜診所雲整合系統所有功能模組檢查完畢。
                            請查看上方各項目的詳細狀態。
                        </div>
                    `;
                }, 3000);
            }, 1000);
        }

        // 頁面載入時自動檢查核心功能
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                checkAppointmentSystem();
                checkGoogleCalendar();
                checkLineBotIntegration();
            }, 1000);
        });
    </script>
</body>
</html>
