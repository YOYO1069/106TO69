<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="stylesheet" href="flos-style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>電子簽署同意書流程模擬 - FLOS劉道玄診所</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #d4af37;
      --dark-blue: #1a1f2e;
      --light-text: #e0e6ed;
    }
    
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #1a1f2e 0%, #16213e 50%, #0f3460 100%);
      color: var(--light-text);
      min-height: 100vh;
    }
    
    .header {
      background-color: rgba(26, 31, 46, 0.8);
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
      padding: 15px 0;
    }
    
    .logo {
      color: var(--primary);
      font-size: 24px;
      font-weight: 700;
    }
    
    .logo i {
      margin-right: 10px;
    }
    
    .flow-container {
      max-width: 1000px;
      margin: 30px auto;
      background-color: rgba(26, 31, 46, 0.7);
      border-radius: 10px;
      border: 1px solid rgba(212, 175, 55, 0.3);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }
    
    .flow-header {
      background-color: rgba(212, 175, 55, 0.2);
      padding: 15px 20px;
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
    }
    
    .flow-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
      margin: 0;
    }
    
    .flow-content {
      padding: 20px;
    }
    
    .flow-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      position: relative;
    }
    
    .flow-steps:after {
      content: '';
      position: absolute;
      top: 25px;
      left: 50px;
      right: 50px;
      height: 2px;
      background-color: rgba(212, 175, 55, 0.3);
      z-index: 1;
    }
    
    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }
    
    .step-number {
      width: 50px;
      height: 50px;
      background-color: var(--dark-blue);
      border: 2px solid var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    .step.active .step-number {
      background-color: var(--primary);
      color: var(--dark-blue);
    }
    
    .step-text {
      font-size: 14px;
      text-align: center;
      max-width: 100px;
    }
    
    .step-content {
      display: none;
    }
    
    .step-content.active {
      display: block;
    }
    
    .form-control, .form-select {
      background-color: rgba(26, 31, 46, 0.8);
      border: 1px solid rgba(212, 175, 55, 0.3);
      color: var(--light-text);
    }
    
    .form-control:focus, .form-select:focus {
      background-color: rgba(26, 31, 46, 0.9);
      border-color: var(--primary);
      color: var(--light-text);
      box-shadow: 0 0 0 0.25rem rgba(212, 175, 55, 0.25);
    }
    
    .form-label {
      color: var(--primary);
      font-weight: 500;
    }
    
    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
      color: var(--dark-blue);
      font-weight: 600;
    }
    
    .btn-primary:hover {
      background-color: #c4a030;
      border-color: #c4a030;
      color: var(--dark-blue);
    }
    
    .btn-outline-primary {
      border-color: var(--primary);
      color: var(--primary);
    }
    
    .btn-outline-primary:hover {
      background-color: var(--primary);
      color: var(--dark-blue);
    }
    
    .consent-box {
      max-height: 300px;
      overflow-y: auto;
      background-color: rgba(26, 31, 46, 0.5);
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .risk-item {
      margin-bottom: 10px;
    }
    
    .signature-pad {
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 5px;
      background-color: rgba(255, 255, 255, 0.1);
      margin-bottom: 15px;
      height: 200px;
      position: relative;
    }
    
    .signature-pad canvas {
      width: 100%;
      height: 100%;
    }
    
    .verification-code {
      font-size: 24px;
      letter-spacing: 5px;
      font-weight: 600;
      color: var(--primary);
      text-align: center;
      margin: 20px 0;
    }
    
    .success-icon {
      font-size: 60px;
      color: #28a745;
      margin-bottom: 20px;
    }
    
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }
    
    .timer {
      font-size: 14px;
      color: rgba(224, 230, 237, 0.7);
      text-align: center;
      margin-top: 10px;
    }
    
    .highlight {
      color: var(--primary);
      font-weight: 500;
    }
    
    .patient-info {
      background-color: rgba(26, 31, 46, 0.5);
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .patient-info-item {
      display: flex;
      margin-bottom: 10px;
    }
    
    .patient-info-label {
      width: 100px;
      color: var(--primary);
      font-weight: 500;
    }
    
    .patient-info-value {
      flex-grow: 1;
    }
    
    .treatment-icon {
      font-size: 24px;
      margin-right: 10px;
      color: var(--primary);
    }
    
    .form-check-input:checked {
      background-color: var(--primary);
      border-color: var(--primary);
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="container">
      <div class="logo">
        <i class="fas fa-spa"></i> FLOS 劉道玄診所
      </div>
    </div>
  </div>
  
  <div class="container">
    <div class="flow-container">
      <div class="flow-header">
        <h2 class="flow-title">電子簽署同意書流程模擬</h2>
      </div>
      
      <div class="flow-content">
        <div class="flow-steps">
          <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-text">選擇病患</div>
          </div>
          <div class="step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-text">選擇處置</div>
          </div>
          <div class="step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-text">閱讀同意書</div>
          </div>
          <div class="step" data-step="4">
            <div class="step-number">4</div>
            <div class="step-text">風險確認</div>
          </div>
          <div class="step" data-step="5">
            <div class="step-number">5</div>
            <div class="step-text">電子簽名</div>
          </div>
          <div class="step" data-step="6">
            <div class="step-number">6</div>
            <div class="step-text">身分驗證</div>
          </div>
          <div class="step" data-step="7">
            <div class="step-number">7</div>
            <div class="step-text">完成確認</div>
          </div>
        </div>
        
        <!-- Step 1: 選擇病患 -->
        <div class="step-content active" id="step1">
          <h4 class="mb-4">選擇病患</h4>
          
          <div class="mb-3">
            <label for="patientSearch" class="form-label">搜尋病患</label>
            <div class="input-group">
              <input type="text" class="form-control" id="patientSearch" placeholder="輸入姓名或身分證字號">
              <button class="btn btn-primary" type="button">搜尋</button>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="form-label">選擇病患</label>
            <select class="form-select" id="patientSelect">
              <option selected>請選擇病患</option>
              <option value="1">林美玲 (A123456789)</option>
              <option value="2">王大明 (B987654321)</option>
              <option value="3">張小華 (C456789123)</option>
            </select>
          </div>
          
          <div class="patient-info d-none" id="patientInfo">
            <h5 class="mb-3">病患基本資料</h5>
            <div class="patient-info-item">
              <div class="patient-info-label">姓名</div>
              <div class="patient-info-value">林美玲</div>
            </div>
            <div class="patient-info-item">
              <div class="patient-info-label">身分證字號</div>
              <div class="patient-info-value">A123456789</div>
            </div>
            <div class="patient-info-item">
              <div class="patient-info-label">出生日期</div>
              <div class="patient-info-value">1985/05/15</div>
            </div>
            <div class="patient-info-item">
              <div class="patient-info-label">聯絡電話</div>
              <div class="patient-info-value">0912-345-678</div>
            </div>
            <div class="patient-info-item">
              <div class="patient-info-label">電子郵件</div>
              <div class="patient-info-value">mei.lin@example.com</div>
            </div>
          </div>
          
          <div class="nav-buttons">
            <div></div>
            <button class="btn btn-primary" id="nextStep1">下一步</button>
          </div>
        </div>
        
        <!-- Step 2: 選擇處置 -->
        <div class="step-content" id="step2">
          <h4 class="mb-4">選擇處置</h4>
          
          <div class="mb-4">
            <label class="form-label">處置類別</label>
            <select class="form-select mb-3" id="treatmentCategory">
              <option selected>請選擇處置類別</option>
              <option value="1">注射類</option>
              <option value="2">雷射類</option>
              <option value="3">手術類</option>
            </select>
          </div>
          
          <div class="mb-4">
            <label class="form-label">處置項目</label>
            <div class="list-group">
              <button type="button" class="list-group-item list-group-item-action bg-transparent text-light border-primary">
                <i class="fas fa-syringe treatment-icon"></i>
                肉毒桿菌注射
              </button>
              <button type="button" class="list-group-item list-group-item-action bg-transparent text-light border-primary">
                <i class="fas fa-tint treatment-icon"></i>
                玻尿酸填充
              </button>
              <button type="button" class="list-group-item list-group-item-action bg-transparent text-light border-primary active">
                <i class="fas fa-magic treatment-icon"></i>
                童顏針療程
              </button>
              <button type="button" class="list-group-item list-group-item-action bg-transparent text-light border-primary">
                <i class="fas fa-fire-alt treatment-icon"></i>
                電波拉皮
              </button>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="form-label">執行醫師</label>
            <select class="form-select" id="doctorSelect">
              <option selected>請選擇執行醫師</option>
              <option value="1">劉道玄 醫師 (專科醫師)</option>
              <option value="2">王美麗 醫師 (專科醫師)</option>
              <option value="3">張建國 醫師 (專科醫師)</option>
            </select>
          </div>
          
          <div class="nav-buttons">
            <button class="btn btn-outline-primary" id="prevStep2">上一步</button>
            <button class="btn btn-primary" id="nextStep2">下一步</button>
          </div>
        </div>
        
        <!-- Step 3: 閱讀同意書 -->
        <div class="step-content" id="step3">
          <h4 class="mb-4">閱讀同意書</h4>
          
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            請仔細閱讀以下同意書內容，確保您完全理解所有風險和注意事項。
          </div>
          
          <div class="consent-box">
            <h5 class="text-center mb-3">童顏針療程同意書</h5>
            
            <p><strong>一、處置說明</strong></p>
            <p>童顏針療程是一種透過注射方式將特定成分注入皮膚，以達到刺激膠原蛋白增生、改善皮膚質地和彈性的美容醫學處置。</p>
            
            <p><strong>二、預期效果</strong></p>
            <p>改善皮膚彈性、緊緻度和質地，減少細紋和皺紋，提升面部輪廓。效果因個人體質差異而有所不同，且非永久性。</p>
            
            <p><strong>三、替代方案</strong></p>
            <p>您可以考慮的替代方案包括但不限於：玻尿酸填充、肉毒桿菌注射、電波拉皮、超音波拉皮、雷射療程等。</p>
            
            <p><strong>四、可能風險與併發症</strong></p>
            <ol>
              <li>注射部位可能出現紅腫、瘀青、疼痛、搔癢等暫時性反應</li>
              <li>可能出現感染、過敏反應、肉芽腫形成等併發症</li>
              <li>極少數情況下可能發生血管栓塞、組織壞死等嚴重併發症</li>
              <li>效果可能不如預期或需要多次治療才能達到理想效果</li>
              <li>可能出現不對稱或不均勻的情況</li>
            </ol>
            
            <p><strong>五、術後注意事項</strong></p>
            <ol>
              <li>治療後24小時內避免按摩或過度觸碰注射部位</li>
              <li>治療後48小時內避免劇烈運動、蒸桑拿、泡熱水澡</li>
              <li>治療後一週內避免過度曝曬於陽光下</li>
              <li>如出現異常腫脹、疼痛、發熱等症狀，請立即聯繫診所</li>
            </ol>
            
            <p><strong>六、費用說明</strong></p>
            <p>本療程費用為新台幣 15,000 元整，包含一次治療及一次回診追蹤。如需額外治療或處理併發症，可能產生額外費用。</p>
            
            <p><strong>七、特別聲明</strong></p>
            <p>本人已詳細閱讀並理解上述內容，醫師已充分說明處置的性質、風險、替代方案及可能的併發症，並已回答本人所有問題。本人同意接受此療程，並願意承擔可能的風險。</p>
            
            <p class="text-center mt-4"><strong>依據台灣醫療法第63條及相關法規：</strong></p>
            <p class="text-center">本電子同意書僅供輔助說明使用，正式同意書仍須以紙本簽署為準。<br>電子簽名僅作為意願表達，不具完整法律效力。<br>實際療程前仍需完成紙本同意書簽署程序。</p>
          </div>
          
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="readConsent">
            <label class="form-check-label" for="readConsent">
              我已詳細閱讀並理解上述同意書內容
            </label>
          </div>
          
          <div class="timer">
            閱讀時間：<span id="readingTimer">00:00</span>
          </div>
          
          <div class="nav-buttons">
            <button class="btn btn-outline-primary" id="prevStep3">上一步</button>
            <button class="btn btn-primary" id="nextStep3" disabled>下一步</button>
          </div>
        </div>
        
        <!-- Step 4: 風險確認 -->
        <div class="step-content" id="step4">
          <h4 class="mb-4">風險確認</h4>
          
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            請確認您已了解以下風險項目，並逐一勾選確認。
          </div>
          
          <div class="risk-item">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="risk1">
              <label class="form-check-label" for="risk1">
                我了解注射部位可能出現<span class="highlight">紅腫、瘀青、疼痛、搔癢</span>等暫時性反應
              </label>
            </div>
          </div>
          
          <div class="risk-item">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="risk2">
              <label class="form-check-label" for="risk2">
                我了解可能出現<span class="highlight">感染、過敏反應、肉芽腫形成</span>等併發症
              </label>
            </div>
          </div>
          
          <div class="risk-item">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="risk3">
              <label class="form-check-label" for="risk3">
                我了解極少數情況下可能發生<span class="highlight">血管栓塞、組織壞死</span>等嚴重併發症
              </label>
            </div>
          </div>
          
          <div class="risk-item">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="risk4">
              <label class="form-check-label" for="risk4">
                我了解效果可能<span class="highlight">不如預期</span>或需要<span class="highlight">多次治療</span>才能達到理想效果
              </label>
            </div>
          </div>
          
          <div class="risk-item">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="risk5">
              <label class="form-check-label" for="risk5">
                我了解可能出現<span class="highlight">不對稱或不均勻</span>的情況
              </label>
            </div>
          </div>
          
          <div class="risk-item mt-4">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="riskAll">
              <label class="form-check-label" for="riskAll">
                <strong>我已完全了解並接受上述所有風險</strong>
              </label>
            </div>
          </div>
          
          <div class="nav-buttons">
            <button class="btn btn-outline-primary" id="prevStep4">上一步</button>
            <button class="btn btn-primary" id="nextStep4" disabled>下一步</button>
          </div>
        </div>
        
        <!-- Step 5: 電子簽名 -->
        <div class="step-content" id="step5">
          <h4 class="mb-4">電子簽名</h4>
          
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            請在下方簽名區域進行簽名，確認您同意接受此療程。
          </div>
          
          <div class="signature-pad" id="signaturePad">
            <canvas id="signatureCanvas"></canvas>
          </div>
          
          <div class="d-flex justify-content-end mb-4">
            <button class="btn btn-outline-primary btn-sm" id="clearSignature">
              <i class="fas fa-eraser me-1"></i> 清除簽名
            </button>
          </div>
          
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="signatureConfirm">
            <label class="form-check-label" for="signatureConfirm">
              我確認這是我的簽名，並同意接受此療程
            </label>
          </div>
          
          <div class="nav-buttons">
            <button class="btn btn-outline-primary" id="prevStep5">上一步</button>
            <button class="btn btn-primary" id="nextStep5" disabled>下一步</button>
          </div>
        </div>
        
        <!-- Step 6: 身分驗證 -->
        <div class="step-content" id="step6">
          <h4 class="mb-4">身分驗證</h4>
          
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            為確保您的身分，我們將發送驗證碼至您的手機。
          </div>
          
          <div class="mb-3">
            <label for="phoneNumber" class="form-label">手機號碼</label>
            <div class="input-group">
              <input type="text" class="form-control" id="phoneNumber" value="0912-345-678" readonly>
              <button class="btn btn-primary" type="button" id="sendVerificationCode">發送驗證碼</button>
            </div>
          </div>
          
          <div class="verification-code d-none" id="verificationCodeDisplay">
            8 3 5 1
          </div>
          
          <div class="mb-4">
            <label for="verificationCode" class="form-label">請輸入驗證碼</label>
            <input type="text" class="form-control" id="verificationCode" placeholder="請輸入4位數驗證碼">
          </div>
          
          <div class="timer d-none" id="verificationTimer">
            驗證碼有效時間：<span id="codeTimer">05:00</span>
          </div>
          
          <div class="nav-buttons">
            <button class="btn btn-outline-primary" id="prevStep6">上一步</button>
            <button class="btn btn-primary" id="nextStep6">驗證並完成</button>
          </div>
        </div>
        
        <!-- Step 7: 完成確認 -->
        <div class="step-content" id="step7">
          <div class="text-center">
            <i class="fas fa-check-circle success-icon"></i>
            <h4 class="mb-3">電子同意書簽署完成！</h4>
            <p class="mb-4">感謝您完成電子同意書的簽署流程。</p>
            
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <strong>重要提醒：</strong><br>
              依據台灣醫療法第63條及相關法規，本電子同意書僅供輔助說明使用，<br>
              正式同意書仍須以紙本簽署為準。<br>
              請於實際療程前完成紙本同意書簽署程序。
            </div>
            
            <div class="mb-4">
              <p>電子同意書編號：<strong>EC-20250926-001</strong></p>
              <p>簽署時間：<strong>2025/09/26 15:30:45</strong></p>
              <p>思考期結束日期：<strong>2025/10/03</strong>（7天後）</p>
            </div>
            
            <div class="d-flex justify-content-center gap-3">
              <button class="btn btn-primary">
                <i class="fas fa-print me-1"></i> 列印同意書
              </button>
              <button class="btn btn-outline-primary">
                <i class="fas fa-envelope me-1"></i> 發送至電子郵件
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 步驟切換功能
      const steps = document.querySelectorAll('.step');
      const stepContents = document.querySelectorAll('.step-content');
      
      function goToStep(stepNumber) {
        steps.forEach(step => {
          if (parseInt(step.dataset.step) <= stepNumber) {
            step.classList.add('active');
          } else {
            step.classList.remove('active');
          }
        });
        
        stepContents.forEach(content => {
          content.classList.remove('active');
        });
        
        document.getElementById(`step${stepNumber}`).classList.add('active');
      }
      
      // 步驟1：選擇病患
      document.getElementById('patientSelect').addEventListener('change', function() {
        if (this.value !== '請選擇病患') {
          document.getElementById('patientInfo').classList.remove('d-none');
        } else {
          document.getElementById('patientInfo').classList.add('d-none');
        }
      });
      
      document.getElementById('nextStep1').addEventListener('click', function() {
        goToStep(2);
      });
      
      // 步驟2：選擇處置
      document.getElementById('prevStep2').addEventListener('click', function() {
        goToStep(1);
      });
      
      document.getElementById('nextStep2').addEventListener('click', function() {
        goToStep(3);
        startReadingTimer();
      });
      
      // 步驟3：閱讀同意書
      let readingInterval;
      let readingSeconds = 0;
      
      function startReadingTimer() {
        readingInterval = setInterval(function() {
          readingSeconds++;
          const minutes = Math.floor(readingSeconds / 60);
          const seconds = readingSeconds % 60;
          document.getElementById('readingTimer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
          
          // 至少閱讀30秒才能勾選已閱讀
          if (readingSeconds >= 30) {
            document.getElementById('readConsent').disabled = false;
          }
        }, 1000);
      }
      
      document.getElementById('readConsent').addEventListener('change', function() {
        document.getElementById('nextStep3').disabled = !this.checked;
      });
      
      document.getElementById('prevStep3').addEventListener('click', function() {
        clearInterval(readingInterval);
        goToStep(2);
      });
      
      document.getElementById('nextStep3').addEventListener('click', function() {
        clearInterval(readingInterval);
        goToStep(4);
      });
      
      // 步驟4：風險確認
      const riskCheckboxes = document.querySelectorAll('#step4 .form-check-input:not(#riskAll)');
      const riskAllCheckbox = document.getElementById('riskAll');
      
      riskAllCheckbox.addEventListener('change', function() {
        const isChecked = this.checked;
        riskCheckboxes.forEach(checkbox => {
          checkbox.checked = isChecked;
        });
        document.getElementById('nextStep4').disabled = !isChecked;
      });
      
      riskCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const allChecked = Array.from(riskCheckboxes).every(cb => cb.checked);
          riskAllCheckbox.checked = allChecked;
          document.getElementById('nextStep4').disabled = !allChecked;
        });
      });
      
      document.getElementById('prevStep4').addEventListener('click', function() {
        goToStep(3);
        startReadingTimer();
      });
      
      document.getElementById('nextStep4').addEventListener('click', function() {
        goToStep(5);
        initSignaturePad();
      });
      
      // 步驟5：電子簽名
      let signaturePad;
      
      function initSignaturePad() {
        const canvas = document.getElementById('signatureCanvas');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        
        signaturePad = {
          isEmpty: true,
          clear: function() {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            this.isEmpty = true;
            updateSignatureState();
          }
        };
        
        let isDrawing = false;
        
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);
        
        function startDrawing(e) {
          isDrawing = true;
          const ctx = canvas.getContext('2d');
          const point = getPointPosition(e);
          ctx.beginPath();
          ctx.moveTo(point.x, point.y);
          signaturePad.isEmpty = false;
        }
        
        function draw(e) {
          if (!isDrawing) return;
          
          e.preventDefault();
          const ctx = canvas.getContext('2d');
          const point = getPointPosition(e);
          
          ctx.lineWidth = 2;
          ctx.lineCap = 'round';
          ctx.strokeStyle = '#d4af37';
          
          ctx.lineTo(point.x, point.y);
          ctx.stroke();
        }
        
        function stopDrawing() {
          isDrawing = false;
          updateSignatureState();
        }
        
        function getPointPosition(e) {
          let x, y;
          
          if (e.type.includes('touch')) {
            const touch = e.touches[0] || e.changedTouches[0];
            const rect = canvas.getBoundingClientRect();
            x = touch.clientX - rect.left;
            y = touch.clientY - rect.top;
          } else {
            const rect = canvas.getBoundingClientRect();
            x = e.clientX - rect.left;
            y = e.clientY - rect.top;
          }
          
          return { x, y };
        }
      }
      
      function updateSignatureState() {
        const signatureConfirm = document.getElementById('signatureConfirm');
        document.getElementById('nextStep5').disabled = signaturePad.isEmpty || !signatureConfirm.checked;
      }
      
      document.getElementById('clearSignature').addEventListener('click', function() {
        signaturePad.clear();
      });
      
      document.getElementById('signatureConfirm').addEventListener('change', function() {
        updateSignatureState();
      });
      
      document.getElementById('prevStep5').addEventListener('click', function() {
        goToStep(4);
      });
      
      document.getElementById('nextStep5').addEventListener('click', function() {
        goToStep(6);
      });
      
      // 步驟6：身分驗證
      let verificationInterval;
      let verificationSeconds = 300; // 5分鐘
      
      document.getElementById('sendVerificationCode').addEventListener('click', function() {
        document.getElementById('verificationCodeDisplay').classList.remove('d-none');
        document.getElementById('verificationTimer').classList.remove('d-none');
        this.disabled = true;
        
        // 啟動倒數計時
        clearInterval(verificationInterval);
        verificationSeconds = 300;
        updateVerificationTimer();
        
        verificationInterval = setInterval(function() {
          verificationSeconds--;
          updateVerificationTimer();
          
          if (verificationSeconds <= 0) {
            clearInterval(verificationInterval);
            document.getElementById('sendVerificationCode').disabled = false;
            document.getElementById('verificationCodeDisplay').classList.add('d-none');
            document.getElementById('verificationTimer').classList.add('d-none');
          }
        }, 1000);
      });
      
      function updateVerificationTimer() {
        const minutes = Math.floor(verificationSeconds / 60);
        const seconds = verificationSeconds % 60;
        document.getElementById('codeTimer').textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }
      
      document.getElementById('prevStep6').addEventListener('click', function() {
        clearInterval(verificationInterval);
        goToStep(5);
      });
      
      document.getElementById('nextStep6').addEventListener('click', function() {
        clearInterval(verificationInterval);
        goToStep(7);
      });
    });
  </script>
</body>
</html>
